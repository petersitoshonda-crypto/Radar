<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Apex â€” Dashboard Q1 2026</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@300;400;500&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root {
  --bg:         #0b0c10;
  --surface:    #13151c;
  --surface2:   #1a1d28;
  --border:     #252836;
  --accent:     #f0a500;
  --accent2:    #e05c2a;
  --text:       #e8eaf0;
  --muted:      #6b7080;
  --ventas:     #3b82f6;
  --repuestos:  #f97316;
  --taller:     #22c55e;
  --transversal:#a78bfa;
  --global:     #a78bfa;
}

* { margin:0; padding:0; box-sizing:border-box; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: 'Syne', sans-serif;
  min-height: 100vh;
  overflow-x: hidden;
}

body::before {
  content: '';
  position: fixed; inset: 0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
  pointer-events: none; z-index: 0; opacity: 0.6;
}

.wrapper {
  position: relative; z-index: 1;
  max-width: 1040px;
  margin: 0 auto;
  padding: 28px 24px 56px;
}

/* â”€â”€ TOP NAV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.top-nav {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 32px;
  flex-wrap: wrap;
  gap: 16px;
}

.brand {
  display: flex; align-items: center; gap: 12px;
}
.brand-mark {
  width: 36px; height: 36px;
  background: var(--accent);
  border-radius: 3px;
  display: flex; align-items: center; justify-content: center;
  font-family: 'DM Mono', monospace;
  font-size: 13px; font-weight: 500;
  color: #0b0c10;
  letter-spacing: -0.02em;
}
.brand-text {
  font-size: 18px; font-weight: 800; letter-spacing: -0.02em;
}
.brand-text span {
  font-family: 'DM Mono', monospace;
  font-size: 10px; font-weight: 400;
  color: var(--muted);
  letter-spacing: 0.15em;
  text-transform: uppercase;
  display: block;
  margin-top: 1px;
}

.page-tabs {
  display: flex; gap: 2px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 4px;
}

.page-tab {
  padding: 9px 20px;
  border-radius: 4px; border: 1px solid transparent;
  background: transparent;
  color: var(--muted);
  font-family: 'Syne', sans-serif;
  font-size: 13px; font-weight: 700;
  cursor: pointer;
  transition: all 0.2s;
  letter-spacing: 0.02em;
  white-space: nowrap;
}
.page-tab:hover { color: var(--text); }
.page-tab.active {
  background: rgba(240,165,0,0.12);
  color: var(--accent);
  border-color: rgba(240,165,0,0.25);
}

/* â”€â”€ PAGE SECTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.page { display: none; }
.page.active { display: block; }

/* â”€â”€ SHARED HEADER ROW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.section-header {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  margin-bottom: 20px;
  flex-wrap: wrap; gap: 12px;
}
.section-eyebrow {
  font-family: 'DM Mono', monospace;
  font-size: 10px; letter-spacing: 0.2em;
  color: var(--accent); text-transform: uppercase;
  margin-bottom: 4px;
}
.section-title {
  font-size: 22px; font-weight: 800; letter-spacing: -0.02em;
}
.selector-wrap { display: flex; flex-direction: column; align-items: flex-end; gap: 5px; }
.selector-label {
  font-family: 'DM Mono', monospace;
  font-size: 10px; letter-spacing: 0.15em;
  color: var(--muted); text-transform: uppercase;
}
select {
  background: var(--surface);
  border: 1px solid var(--border);
  color: var(--text);
  font-family: 'Syne', sans-serif;
  font-size: 14px; font-weight: 600;
  padding: 9px 36px 9px 14px;
  border-radius: 4px; cursor: pointer;
  outline: none; appearance: none; -webkit-appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' fill='none'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%236b7080' stroke-width='1.5' stroke-linecap='round'/%3E%3C/svg%3E");
  background-repeat: no-repeat; background-position: right 12px center;
  min-width: 180px; transition: border-color 0.2s;
}
select:hover, select:focus { border-color: var(--accent); }

/* â”€â”€ RADAR AREA TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.area-tabs {
  display: flex; gap: 2px;
  margin-bottom: 24px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 6px; padding: 4px;
}
.tab {
  flex: 1; padding: 10px 12px;
  border-radius: 4px; border: 1px solid transparent;
  background: transparent; color: var(--muted);
  font-family: 'Syne', sans-serif;
  font-size: 13px; font-weight: 600;
  cursor: pointer; transition: all 0.2s;
  letter-spacing: 0.02em; text-align: center;
}
.tab:hover { color: var(--text); }
.tab.active[data-area="Global"]    { background: rgba(167,139,250,.15); color: var(--global);     border-color: rgba(167,139,250,.3); }
.tab.active[data-area="Ventas"]    { background: rgba(59,130,246,.15);  color: var(--ventas);     border-color: rgba(59,130,246,.3); }
.tab.active[data-area="Repuestos"] { background: rgba(249,115,22,.15);  color: var(--repuestos);  border-color: rgba(249,115,22,.3); }
.tab.active[data-area="Taller"]    { background: rgba(34,197,94,.15);   color: var(--taller);     border-color: rgba(34,197,94,.3); }

/* â”€â”€ MAIN GRID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.main-grid {
  display: grid;
  grid-template-columns: 1fr 240px;
  gap: 20px; align-items: start;
}

.chart-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 8px; padding: 28px;
  position: relative; overflow: hidden;
}
.chart-card::before {
  content: '';
  position: absolute; top: -60px; right: -60px;
  width: 200px; height: 200px; border-radius: 50%;
  background: radial-gradient(circle, rgba(240,165,0,.04) 0%, transparent 70%);
  pointer-events: none;
}

.chart-title-row {
  display: flex; align-items: center;
  justify-content: space-between; margin-bottom: 20px;
}
.chart-title-text {
  font-size: 12px; font-weight: 600;
  color: var(--muted); text-transform: uppercase;
  letter-spacing: 0.08em;
}
.area-indicator {
  font-family: 'DM Mono', monospace;
  font-size: 11px; padding: 3px 10px;
  border-radius: 2px; font-weight: 500; letter-spacing: 0.05em;
}
.area-indicator.Global    { background: rgba(167,139,250,.15); color: var(--global); }
.area-indicator.Ventas    { background: rgba(59,130,246,.15);  color: var(--ventas); }
.area-indicator.Repuestos { background: rgba(249,115,22,.15);  color: var(--repuestos); }
.area-indicator.Taller    { background: rgba(34,197,94,.15);   color: var(--taller); }

.chart-container { position: relative; height: 380px; }

.legend {
  display: flex; gap: 16px; margin-top: 16px;
  justify-content: center; flex-wrap: wrap;
}
.legend-item {
  display: flex; align-items: center; gap: 7px;
  font-size: 11px; color: var(--muted);
  font-family: 'DM Mono', monospace;
}
.legend-swatch { width: 24px; height: 2.5px; border-radius: 2px; }
.legend-swatch.dashed {
  background: repeating-linear-gradient(90deg,
    rgba(255,255,255,.3) 0, rgba(255,255,255,.3) 4px,
    transparent 4px, transparent 8px);
}

/* â”€â”€ SCORES PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.scores-panel { display: flex; flex-direction: column; gap: 10px; }

.score-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 6px; padding: 12px 14px;
  transition: border-color 0.2s;
}
.score-card:hover { border-color: rgba(240,165,0,.25); }

.score-dim {
  font-size: 10px; font-weight: 700;
  letter-spacing: 0.1em; text-transform: uppercase; color: var(--muted);
}
.score-row {
  display: flex; align-items: center;
  justify-content: space-between; margin-top: 6px;
}
.score-label { font-family: 'DM Mono', monospace; font-size: 10px; color: var(--muted); }
.score-value { font-family: 'DM Mono', monospace; font-size: 16px; font-weight: 500; }

.score-bar-track {
  position: relative; height: 3px;
  background: rgba(255,255,255,.07);
  border-radius: 2px; margin-top: 8px; overflow: visible;
}
.score-bar-fill-single {
  height: 100%; border-radius: 2px; transition: width 0.4s ease;
}
.score-bar-avg {
  position: absolute; top: -3px;
  width: 1px; height: 9px;
  background: rgba(255,255,255,.4);
  border-radius: 1px;
}

.area-bars { display: flex; flex-direction: column; gap: 5px; margin-top: 8px; }
.area-bar-row { display: flex; align-items: center; gap: 6px; }
.area-bar-label { font-family: 'DM Mono', monospace; font-size: 9px; width: 22px; flex-shrink: 0; }
.area-bar-track {
  flex: 1; height: 3px;
  background: rgba(255,255,255,.07); border-radius: 2px; overflow: hidden;
}
.area-bar-fill { height: 100%; border-radius: 2px; transition: width 0.4s ease; }
.area-bar-val { font-family: 'DM Mono', monospace; font-size: 10px; width: 14px; text-align: right; }

.diff-badge {
  font-family: 'DM Mono', monospace;
  font-size: 9px; padding: 2px 6px;
  border-radius: 2px; letter-spacing: 0.05em; font-weight: 500;
}
.diff-badge.pos { background: rgba(34,197,94,.15); color: var(--taller); }
.diff-badge.neg { background: rgba(239,68,68,.15);  color: #ef4444; }
.diff-badge.neu { background: rgba(255,255,255,.06); color: var(--muted); }

/* â”€â”€ SUMMARY BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.summary-bar {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 8px; padding: 16px 24px;
  display: grid; gap: 0; margin-top: 20px;
  position: relative; overflow: hidden;
}
.summary-bar::before {
  content: '';
  position: absolute; bottom: -20px; right: -20px;
  width: 120px; height: 120px; border-radius: 50%;
  background: radial-gradient(circle, rgba(240,165,0,.05) 0%, transparent 70%);
  pointer-events: none;
}
.summary-bar.cols-4 { grid-template-columns: repeat(4,1fr); }
.summary-bar.cols-3 { grid-template-columns: repeat(3,1fr); }

.summary-item {
  padding: 4px 16px; text-align: center;
  border-right: 1px solid var(--border);
}
.summary-item:last-child { border-right: none; }

.summary-num {
  font-size: 26px; font-weight: 800;
  letter-spacing: -0.03em; line-height: 1;
}
.summary-lbl {
  font-family: 'DM Mono', monospace;
  font-size: 9px; color: var(--muted);
  text-transform: uppercase; letter-spacing: 0.12em;
  margin-top: 4px;
}
.clr-global    { color: var(--global); }
.clr-ventas    { color: var(--ventas); }
.clr-repuestos { color: var(--repuestos); }
.clr-taller    { color: var(--taller); }

/* â”€â”€ BUBBLE CHART (PORTAFOLIO) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.bubble-layout {
  display: grid;
  grid-template-columns: 1fr 280px;
  gap: 20px; align-items: start;
}

.bubble-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 8px; padding: 28px;
  position: relative; overflow: hidden;
}
.bubble-card::before {
  content: '';
  position: absolute; top: -80px; left: -80px;
  width: 260px; height: 260px; border-radius: 50%;
  background: radial-gradient(circle, rgba(240,165,0,.03) 0%, transparent 70%);
  pointer-events: none;
}

.bubble-container { position: relative; height: 400px; }

/* Quadrant labels overlay */
.quadrant-labels {
  position: absolute; inset: 0;
  pointer-events: none;
  /* offsets match chart padding */
}
.q-label {
  position: absolute;
  font-family: 'DM Mono', monospace;
  font-size: 9px; font-weight: 500;
  letter-spacing: 0.1em; text-transform: uppercase;
  opacity: 0.35;
  padding: 5px 8px;
  border-radius: 3px;
}

/* â”€â”€ PROJECT LIST PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.project-panel { display: flex; flex-direction: column; gap: 10px; }

.project-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 6px; padding: 14px;
  cursor: pointer; transition: all 0.2s;
  position: relative; overflow: hidden;
}
.project-card:hover { border-color: rgba(240,165,0,.3); transform: translateX(2px); }
.project-card.highlighted { border-color: rgba(240,165,0,.5); }

.project-area-bar {
  position: absolute; left: 0; top: 0; bottom: 0;
  width: 3px; border-radius: 6px 0 0 6px;
}

.project-name {
  font-size: 12px; font-weight: 700;
  line-height: 1.3; padding-left: 8px;
  margin-bottom: 8px;
}
.project-meta {
  display: flex; gap: 6px; flex-wrap: wrap; padding-left: 8px;
}
.project-tag {
  font-family: 'DM Mono', monospace;
  font-size: 9px; padding: 2px 6px;
  border-radius: 2px; letter-spacing: 0.05em;
  color: var(--muted);
  border: 1px solid var(--border);
}
.project-tag.rice {
  color: var(--accent);
  border-color: rgba(240,165,0,.3);
  background: rgba(240,165,0,.08);
}
.project-tag.quadrant-qw  { color: #22c55e; border-color: rgba(34,197,94,.3);   background: rgba(34,197,94,.08); }
.project-tag.quadrant-bet { color: #3b82f6; border-color: rgba(59,130,246,.3);  background: rgba(59,130,246,.08); }
.project-tag.quadrant-fil { color: #f0a500; border-color: rgba(240,165,0,.3);   background: rgba(240,165,0,.08); }
.project-tag.quadrant-avo { color: #ef4444; border-color: rgba(239,68,68,.3);   background: rgba(239,68,68,.08); }

.project-rice-row {
  margin-top: 10px; padding-left: 8px;
  display: flex; align-items: center; gap: 8px;
}
.rice-bar-track {
  flex: 1; height: 3px;
  background: rgba(255,255,255,.07); border-radius: 2px; overflow: hidden;
}
.rice-bar-fill { height: 100%; border-radius: 2px; }

/* Quadrant legend */
.quadrant-legend {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 8px; padding: 16px;
  margin-top: 10px;
}
.q-legend-title {
  font-family: 'DM Mono', monospace;
  font-size: 9px; letter-spacing: 0.15em;
  text-transform: uppercase; color: var(--muted);
  margin-bottom: 10px;
}
.q-legend-item {
  display: flex; align-items: flex-start; gap: 8px;
  margin-bottom: 8px;
}
.q-dot {
  width: 8px; height: 8px; border-radius: 50%;
  flex-shrink: 0; margin-top: 3px;
}
.q-legend-text { font-size: 11px; line-height: 1.4; }
.q-legend-sub  { font-family: 'DM Mono', monospace; font-size: 9px; color: var(--muted); margin-top: 1px; }

/* Area legend for bubble */
.area-legend {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 8px; padding: 16px; margin-top: 10px;
}
.area-legend-row {
  display: flex; align-items: center; gap: 8px; margin-bottom: 7px;
}
.area-legend-row:last-child { margin-bottom: 0; }
.area-legend-dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
.area-legend-label { font-size: 12px; font-weight: 600; }
.area-legend-count {
  font-family: 'DM Mono', monospace;
  font-size: 9px; color: var(--muted); margin-left: auto;
}

/* Warning banner */
.data-warning {
  background: rgba(240,165,0,.06);
  border: 1px solid rgba(240,165,0,.2);
  border-radius: 6px; padding: 10px 14px;
  display: flex; align-items: center; gap: 10px;
  margin-top: 16px;
  font-family: 'DM Mono', monospace;
  font-size: 10px; color: rgba(240,165,0,.8);
  letter-spacing: 0.05em;
}
.warning-dot {
  width: 6px; height: 6px; border-radius: 50%;
  background: var(--accent); flex-shrink: 0;
  animation: pulse 2s infinite;
}
@keyframes pulse {
  0%,100% { opacity: 1; } 50% { opacity: .3; }
}

/* â”€â”€ BOTTOM SUMMARY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.bubble-summary {
  display: grid;
  grid-template-columns: repeat(4,1fr);
  gap: 12px; margin-top: 20px;
}
.bsum-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 8px; padding: 14px 16px;
  text-align: center;
}
.bsum-num {
  font-size: 24px; font-weight: 800;
  letter-spacing: -0.03em; line-height: 1;
}
.bsum-lbl {
  font-family: 'DM Mono', monospace;
  font-size: 9px; color: var(--muted);
  text-transform: uppercase; letter-spacing: 0.12em;
  margin-top: 5px;
}

/* â”€â”€ MISSING FIELDS BANNER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.missing-banner {
  background: rgba(239,68,68,.06);
  border: 1px solid rgba(239,68,68,.2);
  border-radius: 6px; padding: 10px 14px;
  margin-top: 16px;
  font-family: 'DM Mono', monospace;
  font-size: 10px; line-height: 1.6;
  color: rgba(239,68,68,.8);
}
.missing-title {
  font-weight: 500; margin-bottom: 4px;
  letter-spacing: 0.08em; text-transform: uppercase;
}
</style>
</head>
<body>
<div class="wrapper">

  <!-- â”€â”€ TOP NAV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <nav class="top-nav">
    <div class="brand">
      <div class="brand-mark">Ax</div>
      <div class="brand-text">
        Apex
        <span>Q1 2026 Â· 8 Comerciales</span>
      </div>
    </div>
    <div class="page-tabs">
      <button class="page-tab active" onclick="showPage('radar')">ğŸ¯ Radar de Madurez</button>
      <button class="page-tab" onclick="showPage('portafolio')">ğŸ“Š Portafolio</button>
    </div>
  </nav>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- PAGE: RADAR                                        -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="page-radar" class="page active">

    <div class="section-header">
      <div>
        <div class="section-eyebrow">Assessment Madurez Digital</div>
        <div class="section-title">Radar por Comercial</div>
      </div>
      <div class="selector-wrap">
        <div class="selector-label">Comercial</div>
        <select id="comercialSelect">
          <option>Fahonda</option>
          <option>Suzuki</option>
          <option>Cadisa</option>
          <option>Moto Premium</option>
          <option>Indy Motos</option>
          <option>ESSA</option>
          <option>Hipertienda</option>
          <option>HipertiendaSV</option>
        </select>
      </div>
    </div>

    <div class="area-tabs">
      <button class="tab active" data-area="Global"    onclick="setArea('Global')">ğŸŒ Global</button>
      <button class="tab"        data-area="Ventas"    onclick="setArea('Ventas')">ğŸ“Š Ventas</button>
      <button class="tab"        data-area="Repuestos" onclick="setArea('Repuestos')">ğŸ“¦ Repuestos</button>
      <button class="tab"        data-area="Taller"    onclick="setArea('Taller')">ğŸ”§ Taller</button>
    </div>

    <div class="main-grid">
      <div class="chart-card">
        <div class="chart-title-row">
          <div class="chart-title-text" id="chartTitleText">Perfil global â€” 3 Ã¡reas Ã— 6 dimensiones</div>
          <div class="area-indicator Global" id="areaIndicator">Global</div>
        </div>
        <div class="chart-container">
          <canvas id="radarChart"></canvas>
        </div>
        <div class="legend" id="legend"></div>
      </div>
      <div class="scores-panel" id="scoresPanel"></div>
    </div>

    <div class="summary-bar cols-4" id="summaryBar"></div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- PAGE: PORTAFOLIO                                   -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="page-portafolio" class="page">

    <div class="section-header">
      <div>
        <div class="section-eyebrow">PriorizaciÃ³n RICE Â· Impact vs Esfuerzo</div>
        <div class="section-title">Portafolio de Proyectos</div>
      </div>
    </div>

    <div class="bubble-layout">
      <div class="bubble-card">
        <div class="chart-title-row">
          <div class="chart-title-text">RICE Score vs Esfuerzo Â· tamaÃ±o = # comerciales</div>
          <div class="area-indicator" style="background:rgba(240,165,0,.1);color:var(--accent);">Demo</div>
        </div>
        <div class="bubble-container">
          <canvas id="bubbleChart"></canvas>
        </div>
      </div>

      <div>
        <div class="project-panel" id="projectPanel"></div>

        <div class="quadrant-legend">
          <div class="q-legend-title">Cuadrantes</div>
          <div class="q-legend-item">
            <div class="q-dot" style="background:#22c55e"></div>
            <div>
              <div class="q-legend-text" style="color:#22c55e">Quick Wins</div>
              <div class="q-legend-sub">Alto impacto Â· bajo esfuerzo</div>
            </div>
          </div>
          <div class="q-legend-item">
            <div class="q-dot" style="background:#3b82f6"></div>
            <div>
              <div class="q-legend-text" style="color:#3b82f6">Apuestas EstratÃ©gicas</div>
              <div class="q-legend-sub">Alto impacto Â· alto esfuerzo</div>
            </div>
          </div>
          <div class="q-legend-item">
            <div class="q-dot" style="background:#f0a500"></div>
            <div>
              <div class="q-legend-text" style="color:#f0a500">Fill-ins</div>
              <div class="q-legend-sub">Bajo impacto Â· bajo esfuerzo</div>
            </div>
          </div>
          <div class="q-legend-item">
            <div class="q-dot" style="background:#ef4444"></div>
            <div>
              <div class="q-legend-text" style="color:#ef4444">Evitar</div>
              <div class="q-legend-sub">Bajo impacto Â· alto esfuerzo</div>
            </div>
          </div>
        </div>

        <div class="area-legend">
          <div class="q-legend-title">Ãrea funcional</div>
          <div class="area-legend-row">
            <div class="area-legend-dot" style="background:var(--ventas)"></div>
            <div class="area-legend-label">Ventas</div>
          </div>
          <div class="area-legend-row">
            <div class="area-legend-dot" style="background:var(--repuestos)"></div>
            <div class="area-legend-label">Repuestos</div>
          </div>
          <div class="area-legend-row">
            <div class="area-legend-dot" style="background:var(--taller)"></div>
            <div class="area-legend-label">Taller</div>
          </div>
          <div class="area-legend-row">
            <div class="area-legend-dot" style="background:var(--transversal)"></div>
            <div class="area-legend-label">Transversal</div>
          </div>
        </div>
      </div>
    </div>

    <div class="bubble-summary" id="bubbleSummary"></div>

    <div class="data-warning">
      <div class="warning-dot"></div>
      DATOS DEMO Â· Actualizar PROYECTOS[] con datos reales del Portafolio tras el assessment
    </div>
  </div>

</div><!-- /wrapper -->

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â”€â”€ DATA: RADAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
/*
  Estructura: DATA[Comercial][Ãrea] = [Personas, TecnologÃ­a, Gobernanza, Cliente, Operaciones, InnovaciÃ³n]
  Escala: 1=Inicial  2=Emergente  3=Definido  4=Avanzado  5=LÃ­der
  CÃ³mo actualizar: reemplaza los 6 nÃºmeros de cada array con el promedio del assessment
*/
const DATA = {
  // â”€â”€ FAHONDA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  'Fahonda':        { Ventas: [3,3,2,3,3,2], Repuestos: [2,2,2,2,3,2], Taller: [2,3,2,2,2,2] },
  // â”€â”€ SUZUKI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  'Suzuki':         { Ventas: [4,3,3,4,3,3], Repuestos: [3,3,2,3,3,2], Taller: [3,3,3,3,3,2] },
  // â”€â”€ CADISA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  'Cadisa':         { Ventas: [2,2,2,2,2,2], Repuestos: [2,2,1,2,2,1], Taller: [1,2,1,2,2,1] },
  // â”€â”€ MOTO PREMIUM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  'Moto Premium':   { Ventas: [3,4,3,3,4,3], Repuestos: [3,3,3,3,3,2], Taller: [3,4,3,3,3,3] },
  // â”€â”€ INDY MOTOS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  'Indy Motos':     { Ventas: [2,3,2,2,3,2], Repuestos: [2,2,2,2,2,2], Taller: [2,2,2,2,3,2] },
  // â”€â”€ ESSA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  'ESSA':           { Ventas: [3,3,3,3,3,2], Repuestos: [3,3,2,3,3,2], Taller: [2,3,2,3,3,2] },
  // â”€â”€ HIPERTIENDA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  'Hipertienda':    { Ventas: [4,4,3,4,4,3], Repuestos: [3,4,3,3,4,3], Taller: [3,4,3,4,4,3] },
  // â”€â”€ HIPERTIENDASV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  'HipertiendaSV':  { Ventas: [3,3,2,3,3,2], Repuestos: [2,3,2,2,3,2], Taller: [2,3,2,3,3,2] },
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â”€â”€ DATA: PORTAFOLIO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
/*
  Campos:
    nombre      : string
    area        : 'Ventas' | 'Repuestos' | 'Taller' | 'Transversal'
    estado      : string (para referencia)
    reach       : nÃºmero de comerciales impactadas (1-8)
    gapCierra   : puntos de radar que mueve (0.5-2.0), null si no definido
    effort      : 1=PequeÃ±o  2=Mediano  3=Grande
    confidence  : 50 | 80 | 100
    okrLinked   : true | false
    notas       : string opcional
*/
const PROYECTOS = [
  {
    nombre:     'Bunker F2 â€” UTM Tracking',
    area:       'Transversal',
    estado:     'ğŸƒ En Sprint',
    reach:      8,
    gapCierra:  null,   // â† pendiente: llenar tras definir OKRs
    effort:     2,
    confidence: 80,
    okrLinked:  false,
    notas:      'Conectar activos digitales con mediciÃ³n de medios'
  },
  {
    nombre:     'Adjudicador',
    area:       'Transversal',
    estado:     'ğŸƒ En Sprint',
    reach:      8,
    gapCierra:  null,   // â† pendiente
    effort:     3,
    confidence: 80,
    okrLinked:  false,
    notas:      'Gobernanza de asignaciÃ³n de unidades'
  },
  {
    nombre:     'Bunker F1 â€” ConexiÃ³n Activos',
    area:       'Transversal',
    estado:     'ğŸƒ En Sprint',
    reach:      8,
    gapCierra:  null,   // â† pendiente
    effort:     3,
    confidence: 80,
    okrLinked:  false,
    notas:      'Base de datos unificada de activos digitales'
  },
  // â”€â”€ PROYECTOS EJEMPLO (borrar cuando tengas datos reales) â”€â”€
  {
    nombre:     'CRM Ventas â€” Ejemplo',
    area:       'Ventas',
    estado:     'ğŸ“¥ Propuesto',
    reach:      5,
    gapCierra:  1.2,
    effort:     2,
    confidence: 80,
    okrLinked:  true,
    notas:      'Ejemplo: impact medio, esfuerzo bajo'
  },
  {
    nombre:     'Portal Taller Digital â€” Ejemplo',
    area:       'Taller',
    estado:     'ğŸ“¥ Propuesto',
    reach:      6,
    gapCierra:  1.8,
    effort:     3,
    confidence: 100,
    okrLinked:  true,
    notas:      'Ejemplo: apuesta estratÃ©gica'
  },
  {
    nombre:     'Stock Predictor â€” Ejemplo',
    area:       'Repuestos',
    estado:     'ğŸ” Evaluado',
    reach:      4,
    gapCierra:  0.6,
    effort:     1,
    confidence: 80,
    okrLinked:  true,
    notas:      'Ejemplo: quick win'
  },
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â”€â”€ CONSTANTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DIMS  = ['Personas','TecnologÃ­a','Gobernanza','Cliente','Operaciones','InnovaciÃ³n'];
const AREAS = ['Ventas','Repuestos','Taller'];
const COMS  = Object.keys(DATA);

const AREA_COLORS = {
  Ventas:    { line: '#3b82f6', fill: 'rgba(59,130,246,0.12)' },
  Repuestos: { line: '#f97316', fill: 'rgba(249,115,22,0.12)' },
  Taller:    { line: '#22c55e', fill: 'rgba(34,197,94,0.12)' },
};
const FUNC_COLORS = {
  Ventas:       '#3b82f6',
  Repuestos:    '#f97316',
  Taller:       '#22c55e',
  Transversal:  '#a78bfa',
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â”€â”€ RADAR STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentCom  = 'Fahonda';
let currentArea = 'Global';
let radarChart;

const mean = arr => +( arr.reduce((a,b)=>a+b,0)/arr.length ).toFixed(2);

function groupAvg(area) {
  return DIMS.map((_, i) =>
    +( COMS.reduce((s,c)=>s+DATA[c][area][i],0)/COMS.length ).toFixed(1)
  );
}
function globalGroupAvg() {
  return DIMS.map((_, i) =>
    +( COMS.reduce((s,c)=>s+(DATA[c].Ventas[i]+DATA[c].Repuestos[i]+DATA[c].Taller[i])/3,0)/COMS.length ).toFixed(1)
  );
}

function diffClass(d) { return d > 0 ? 'pos' : d < 0 ? 'neg' : 'neu'; }
function diffLabel(d) { return d > 0 ? `+${d}` : `${d}`; }
function clrClass(d)  { return d > 0 ? 'clr-taller' : d < 0 ? '' : ''; }

function makeDatasets() {
  if (currentArea === 'Global') {
    const grpLine = { color:'rgba(255,255,255,0.2)', fill:'rgba(255,255,255,0.02)', dash:[5,4] };
    return [
      ...AREAS.map(a => ({
        label: a,
        data: DATA[currentCom][a],
        borderColor: AREA_COLORS[a].line,
        backgroundColor: AREA_COLORS[a].fill,
        borderWidth: 2.5,
        pointBackgroundColor: AREA_COLORS[a].line,
        pointBorderColor: '#0b0c10', pointBorderWidth: 2,
        pointRadius: 5, pointHoverRadius: 7, tension: 0.1
      })),
      {
        label: 'Promedio grupo',
        data: globalGroupAvg(),
        borderColor: grpLine.color, backgroundColor: grpLine.fill,
        borderWidth: 1.5, borderDash: [5,4],
        pointBackgroundColor: 'rgba(255,255,255,0.35)',
        pointBorderColor: '#0b0c10', pointBorderWidth: 1,
        pointRadius: 3, pointHoverRadius: 5, tension: 0.1
      }
    ];
  } else {
    const c = AREA_COLORS[currentArea];
    return [
      {
        label: currentCom,
        data: DATA[currentCom][currentArea],
        borderColor: c.line, backgroundColor: c.fill,
        borderWidth: 2.5,
        pointBackgroundColor: c.line,
        pointBorderColor: '#0b0c10', pointBorderWidth: 2,
        pointRadius: 5, pointHoverRadius: 7, tension: 0.1
      },
      {
        label: 'Promedio grupo',
        data: groupAvg(currentArea),
        borderColor: 'rgba(255,255,255,0.2)', backgroundColor: 'rgba(255,255,255,0.02)',
        borderWidth: 1.5, borderDash: [5,4],
        pointBackgroundColor: 'rgba(255,255,255,0.35)',
        pointBorderColor: '#0b0c10', pointBorderWidth: 1,
        pointRadius: 3, pointHoverRadius: 5, tension: 0.1
      }
    ];
  }
}

function buildRadar() {
  const ctx = document.getElementById('radarChart').getContext('2d');
  radarChart = new Chart(ctx, {
    type: 'radar',
    data: { labels: DIMS, datasets: makeDatasets() },
    options: {
      responsive: true, maintainAspectRatio: false,
      animation: { duration: 450, easing: 'easeInOutQuart' },
      scales: {
        r: {
          min: 0, max: 5,
          ticks: {
            stepSize: 1, display: true,
            color: 'rgba(255,255,255,0.18)',
            font: { family: 'DM Mono', size: 9 },
            backdropColor: 'transparent',
            callback: v => v === 0 ? '' : v
          },
          grid:        { color: 'rgba(255,255,255,0.06)', circular: false },
          angleLines:  { color: 'rgba(255,255,255,0.06)' },
          pointLabels: {
            color: 'rgba(232,234,240,0.85)',
            font: { family: 'Syne', size: 12, weight: '600' }, padding: 12
          }
        }
      },
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor: '#1a1d28', borderColor: 'rgba(255,255,255,0.1)', borderWidth: 1,
          titleColor: '#f0a500', bodyColor: '#e8eaf0',
          titleFont: { family: 'Syne', size: 12, weight: '700' },
          bodyFont:  { family: 'DM Mono', size: 12 }, padding: 12,
          callbacks: { label: ctx => ` ${ctx.dataset.label}: ${ctx.raw} / 5` }
        }
      }
    }
  });
}

function updateLegend() {
  const el = document.getElementById('legend');
  let html = '';
  if (currentArea === 'Global') {
    html = AREAS.map(a =>
      `<div class="legend-item">
        <div class="legend-swatch" style="background:${AREA_COLORS[a].line}"></div>
        <span>${a}</span>
      </div>`).join('');
  } else {
    html = `<div class="legend-item">
      <div class="legend-swatch" style="background:${AREA_COLORS[currentArea].line}"></div>
      <span>${currentCom}</span>
    </div>`;
  }
  html += `<div class="legend-item"><div class="legend-swatch dashed"></div><span>Promedio grupo</span></div>`;
  el.innerHTML = html;
}

function updateScores() {
  const panel = document.getElementById('scoresPanel');
  if (currentArea === 'Global') {
    panel.innerHTML = DIMS.map((dim, i) => {
      const vals = AREAS.map(a => DATA[currentCom][a][i]);
      const comG = +( vals.reduce((a,b)=>a+b,0)/3 ).toFixed(1);
      const grpG = globalGroupAvg()[i];
      const diff = +( comG - grpG ).toFixed(1);
      const bars = AREAS.map(a => {
        const v = DATA[currentCom][a][i];
        return `<div class="area-bar-row">
          <span class="area-bar-label" style="color:${AREA_COLORS[a].line}">${a.slice(0,3).toUpperCase()}</span>
          <div class="area-bar-track">
            <div class="area-bar-fill" style="width:${v/5*100}%;background:${AREA_COLORS[a].line}"></div>
          </div>
          <span class="area-bar-val" style="color:${AREA_COLORS[a].line}">${v}</span>
        </div>`;
      }).join('');
      return `<div class="score-card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div class="score-dim">${dim}</div>
          <span class="diff-badge ${diffClass(diff)}">${diffLabel(diff)}</span>
        </div>
        <div class="area-bars">${bars}</div>
      </div>`;
    }).join('');
  } else {
    const comData = DATA[currentCom][currentArea];
    const avgData = groupAvg(currentArea);
    const c = AREA_COLORS[currentArea];
    panel.innerHTML = DIMS.map((dim, i) => {
      const val  = comData[i];
      const avg  = avgData[i];
      const diff = +( val - avg ).toFixed(1);
      return `<div class="score-card">
        <div class="score-dim">${dim}</div>
        <div class="score-row">
          <span class="score-label">Comercial</span>
          <div style="display:flex;align-items:center;gap:6px">
            <span class="score-value" style="color:${c.line}">${val}.0</span>
            <span class="diff-badge ${diffClass(diff)}">${diffLabel(diff)}</span>
          </div>
        </div>
        <div class="score-row">
          <span class="score-label">Grupo avg</span>
          <span class="score-value" style="color:rgba(255,255,255,0.3)">${avg}</span>
        </div>
        <div class="score-bar-track">
          <div class="score-bar-fill-single" style="width:${val/5*100}%;background:${c.line}"></div>
          <div class="score-bar-avg" style="left:${avg/5*100}%"></div>
        </div>
      </div>`;
    }).join('');
  }
}

function updateSummary() {
  const bar = document.getElementById('summaryBar');
  if (currentArea === 'Global') {
    bar.className = 'summary-bar cols-4';
    const scores = AREAS.map(a => mean(DATA[currentCom][a]));
    const global = +( scores.reduce((a,b)=>a+b,0)/3 ).toFixed(2);
    bar.innerHTML = `
      <div class="summary-item"><div class="summary-num clr-global">${global}</div><div class="summary-lbl">Score global</div></div>
      <div class="summary-item"><div class="summary-num clr-ventas">${scores[0]}</div><div class="summary-lbl">Ventas</div></div>
      <div class="summary-item"><div class="summary-num clr-repuestos">${scores[1]}</div><div class="summary-lbl">Repuestos</div></div>
      <div class="summary-item"><div class="summary-num clr-taller">${scores[2]}</div><div class="summary-lbl">Taller</div></div>`;
  } else {
    bar.className = 'summary-bar cols-3';
    const comData = DATA[currentCom][currentArea];
    const avgData = groupAvg(currentArea);
    const comAvg  = mean(comData);
    const grpAvg  = mean(avgData);
    const diff    = +( comAvg - grpAvg ).toFixed(2);
    bar.innerHTML = `
      <div class="summary-item"><div class="summary-num" style="color:${AREA_COLORS[currentArea].line}">${comAvg}</div><div class="summary-lbl">Score comercial</div></div>
      <div class="summary-item"><div class="summary-num" style="color:rgba(255,255,255,0.35)">${grpAvg}</div><div class="summary-lbl">Promedio grupo</div></div>
      <div class="summary-item"><div class="summary-num ${clrClass(diff)}">${diffLabel(diff)}</div><div class="summary-lbl">vs Grupo</div></div>`;
  }
}

function updateLabels() {
  const ind = document.getElementById('areaIndicator');
  ind.textContent = currentArea;
  ind.className = `area-indicator ${currentArea}`;
  const titles = {
    Global:    'Perfil global â€” 3 Ã¡reas Ã— 6 dimensiones',
    Ventas:    'Perfil de madurez â€” Ventas',
    Repuestos: 'Perfil de madurez â€” Repuestos',
    Taller:    'Perfil de madurez â€” Taller'
  };
  document.getElementById('chartTitleText').textContent = titles[currentArea];
}

function renderRadar() {
  if (radarChart) { radarChart.data.datasets = makeDatasets(); radarChart.update(); }
  updateLabels(); updateLegend(); updateScores(); updateSummary();
}

function setArea(area) {
  currentArea = area;
  document.querySelectorAll('.tab').forEach(t =>
    t.classList.toggle('active', t.dataset.area === area));
  renderRadar();
}

document.getElementById('comercialSelect').addEventListener('change', e => {
  currentCom = e.target.value; renderRadar();
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â”€â”€ BUBBLE CHART: PORTAFOLIO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function calcImpact(gapCierra) {
  if (!gapCierra) return 1;
  if (gapCierra >= 1.5) return 3;
  if (gapCierra >= 0.8) return 2;
  return 1;
}

function calcRICE(p) {
  const impact = calcImpact(p.gapCierra);
  return +( (p.reach * impact * p.confidence) / (p.effort * 100) ).toFixed(2);
}

function getQuadrant(rice, effort) {
  const riceThresh = 8;  // midpoint for "high" RICE
  const effortThresh = 2; // midpoint for effort
  if (rice >= riceThresh && effort <= effortThresh) return 'qw';   // Quick Win
  if (rice >= riceThresh && effort >  effortThresh) return 'bet';  // Apuesta
  if (rice <  riceThresh && effort <= effortThresh) return 'fil';  // Fill-in
  return 'avo'; // Evitar
}

const Q_LABELS = {
  qw:  { text:'Quick Win',           color:'#22c55e' },
  bet: { text:'Apuesta EstratÃ©gica', color:'#3b82f6' },
  fil: { text:'Fill-in',             color:'#f0a500' },
  avo: { text:'Evitar',              color:'#ef4444' },
};

let bubbleChart;
let highlightedIdx = null;

function buildBubble() {
  const ctx = document.getElementById('bubbleChart').getContext('2d');

  const datasets = PROYECTOS.map((p, idx) => {
    const rice = calcRICE(p);
    const color = FUNC_COLORS[p.area];
    return {
      label: p.nombre,
      data: [{
        x: p.effort,
        y: rice,
        r: Math.max(6, p.reach * 3.5)
      }],
      backgroundColor: color + '55',
      borderColor: color,
      borderWidth: 2,
      hoverBorderWidth: 3,
      hoverBorderColor: '#f0a500',
      _idx: idx
    };
  });

  bubbleChart = new Chart(ctx, {
    type: 'bubble',
    data: { datasets },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      animation: { duration: 500, easing: 'easeInOutQuart' },
      scales: {
        x: {
          min: 0, max: 4,
          title: {
            display: true,
            text: 'Esfuerzo â†’',
            color: 'rgba(255,255,255,0.3)',
            font: { family: 'DM Mono', size: 10 },
          },
          ticks: {
            color: 'rgba(255,255,255,0.3)',
            font: { family: 'DM Mono', size: 10 },
            callback: v => v === 1 ? 'PequeÃ±o' : v === 2 ? 'Mediano' : v === 3 ? 'Grande' : ''
          },
          grid: { color: 'rgba(255,255,255,0.05)' },
          border: { color: 'rgba(255,255,255,0.08)' }
        },
        y: {
          min: 0,
          title: {
            display: true,
            text: 'RICE Score â†‘',
            color: 'rgba(255,255,255,0.3)',
            font: { family: 'DM Mono', size: 10 },
          },
          ticks: { color: 'rgba(255,255,255,0.3)', font: { family: 'DM Mono', size: 10 } },
          grid: { color: 'rgba(255,255,255,0.05)' },
          border: { color: 'rgba(255,255,255,0.08)' }
        }
      },
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor: '#1a1d28',
          borderColor: 'rgba(255,255,255,0.1)', borderWidth: 1,
          titleColor: '#f0a500', bodyColor: '#e8eaf0',
          titleFont: { family: 'Syne', size: 12, weight: '700' },
          bodyFont:  { family: 'DM Mono', size: 11 },
          padding: 14,
          callbacks: {
            title: items => PROYECTOS[items[0].datasetIndex].nombre,
            label: item => {
              const p = PROYECTOS[item.datasetIndex];
              const rice = calcRICE(p);
              const impact = calcImpact(p.gapCierra);
              const q = getQuadrant(rice, p.effort);
              return [
                ` RICE Score: ${rice}`,
                ` Ãrea: ${p.area}`,
                ` Reach: ${p.reach} comerciales`,
                ` Impact: ${impact}${p.gapCierra ? '' : ' (sin OKR)'}`,
                ` Esfuerzo: ${['','PequeÃ±o','Mediano','Grande'][p.effort]}`,
                ` Cuadrante: ${Q_LABELS[q].text}`,
              ];
            }
          }
        }
      },
      // Draw quadrant lines as annotation plugin workaround via afterDraw
    },
    plugins: [{
      id: 'quadrantLines',
      afterDraw(chart) {
        const { ctx, chartArea: { left, right, top, bottom }, scales } = chart;
        const xMid = scales.x.getPixelForValue(2);
        const yMid = scales.y.getPixelForValue(8);

        ctx.save();
        ctx.setLineDash([4, 6]);
        ctx.strokeStyle = 'rgba(255,255,255,0.1)';
        ctx.lineWidth = 1;

        // vertical midline
        ctx.beginPath(); ctx.moveTo(xMid, top); ctx.lineTo(xMid, bottom); ctx.stroke();
        // horizontal midline
        ctx.beginPath(); ctx.moveTo(left, yMid); ctx.lineTo(right, yMid); ctx.stroke();
        ctx.restore();

        // Quadrant background tints
        const quads = [
          { x: left,  y: top,   w: xMid-left,   h: yMid-top,    color: 'rgba(59,130,246,0.03)'  }, // top-left: Apuesta
          { x: xMid,  y: top,   w: right-xMid,  h: yMid-top,    color: 'rgba(34,197,94,0.04)'   }, // top-right: Quick Win
          { x: left,  y: yMid,  w: xMid-left,   h: bottom-yMid, color: 'rgba(239,68,68,0.03)'   }, // bot-left: Evitar
          { x: xMid,  y: yMid,  w: right-xMid,  h: bottom-yMid, color: 'rgba(240,165,0,0.03)'   }, // bot-right: Fill-in
        ];
        quads.forEach(q => {
          ctx.save();
          ctx.fillStyle = q.color;
          ctx.fillRect(q.x, q.y, q.w, q.h);
          ctx.restore();
        });

        // Quadrant labels
        const qlabels = [
          { text: 'â— Apuesta',  x: left+8,  y: top+14,    color: 'rgba(59,130,246,0.5)' },
          { text: 'â— Quick Win',x: xMid+8,  y: top+14,    color: 'rgba(34,197,94,0.5)' },
          { text: 'â— Evitar',   x: left+8,  y: bottom-8,  color: 'rgba(239,68,68,0.5)' },
          { text: 'â— Fill-in',  x: xMid+8,  y: bottom-8,  color: 'rgba(240,165,0,0.5)' },
        ];
        qlabels.forEach(l => {
          ctx.save();
          ctx.font = '500 9px DM Mono, monospace';
          ctx.fillStyle = l.color;
          ctx.fillText(l.text, l.x, l.y);
          ctx.restore();
        });
      }
    }]
  });
}

function renderProjectPanel() {
  const panel = document.getElementById('projectPanel');
  panel.innerHTML = PROYECTOS.map((p, idx) => {
    const rice = calcRICE(p);
    const maxRice = Math.max(...PROYECTOS.map(calcRICE), 1);
    const color = FUNC_COLORS[p.area];
    const q = getQuadrant(rice, p.effort);
    const missing = [];
    if (!p.okrLinked) missing.push('OKR');
    if (!p.gapCierra) missing.push('Gap');

    return `<div class="project-card" id="pcard-${idx}"
      onmouseenter="highlightBubble(${idx})"
      onmouseleave="unhighlightBubble()">
      <div class="project-area-bar" style="background:${color}"></div>
      <div class="project-name">${p.nombre}</div>
      <div class="project-meta">
        <span class="project-tag">${p.area}</span>
        <span class="project-tag">${p.estado}</span>
        <span class="project-tag rice">RICE ${rice}</span>
        <span class="project-tag quadrant-${q}">${Q_LABELS[q].text}</span>
      </div>
      <div class="project-rice-row">
        <div class="rice-bar-track">
          <div class="rice-bar-fill" style="width:${rice/maxRice*100}%;background:${color}"></div>
        </div>
        <span style="font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);min-width:28px;text-align:right">${rice}</span>
      </div>
      ${missing.length ? `<div style="margin-top:8px;padding-left:8px;font-family:'DM Mono',monospace;font-size:9px;color:rgba(239,68,68,0.7)">âš  falta: ${missing.join(', ')}</div>` : ''}
    </div>`;
  }).join('');
}

function renderBubbleSummary() {
  const rices = PROYECTOS.map(calcRICE);
  const maxRice = Math.max(...rices);
  const incompletos = PROYECTOS.filter(p => !p.okrLinked || !p.gapCierra).length;
  const quickWins  = PROYECTOS.filter(p => getQuadrant(calcRICE(p), p.effort) === 'qw').length;
  const totalReach = [...new Set(PROYECTOS.reduce((acc, p) => [...acc, ...Array(p.reach).fill(0).map((_,i)=>i+1)], []))].length;

  document.getElementById('bubbleSummary').innerHTML = `
    <div class="bsum-card">
      <div class="bsum-num" style="color:var(--accent)">${PROYECTOS.length}</div>
      <div class="bsum-lbl">Proyectos</div>
    </div>
    <div class="bsum-card">
      <div class="bsum-num" style="color:#22c55e">${quickWins}</div>
      <div class="bsum-lbl">Quick Wins</div>
    </div>
    <div class="bsum-card">
      <div class="bsum-num" style="color:var(--accent)">${maxRice}</div>
      <div class="bsum-lbl">RICE MÃ¡x</div>
    </div>
    <div class="bsum-card">
      <div class="bsum-num" style="color:${incompletos > 0 ? '#ef4444' : '#22c55e'}">${incompletos}</div>
      <div class="bsum-lbl">Sin OKR/Gap</div>
    </div>`;
}

function highlightBubble(idx) {
  if (!bubbleChart) return;
  bubbleChart.data.datasets.forEach((ds, i) => {
    ds.borderWidth = i === idx ? 4 : 1;
    ds.borderColor = i === idx ? '#f0a500' : FUNC_COLORS[PROYECTOS[i].area];
    ds.backgroundColor = i === idx
      ? FUNC_COLORS[PROYECTOS[i].area] + 'AA'
      : FUNC_COLORS[PROYECTOS[i].area] + '33';
  });
  bubbleChart.update('none');
}

function unhighlightBubble() {
  if (!bubbleChart) return;
  bubbleChart.data.datasets.forEach((ds, i) => {
    ds.borderWidth = 2;
    ds.borderColor = FUNC_COLORS[PROYECTOS[i].area];
    ds.backgroundColor = FUNC_COLORS[PROYECTOS[i].area] + '55';
  });
  bubbleChart.update('none');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â”€â”€ PAGE NAVIGATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showPage(page) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.page-tab').forEach(t => t.classList.remove('active'));
  document.getElementById('page-' + page).classList.add('active');
  document.querySelectorAll('.page-tab').forEach(t => {
    if (t.textContent.toLowerCase().includes(page === 'radar' ? 'radar' : 'portafolio'))
      t.classList.add('active');
  });

  // Build bubble chart on first visit
  if (page === 'portafolio' && !bubbleChart) {
    setTimeout(() => {
      buildBubble();
      renderProjectPanel();
      renderBubbleSummary();
    }, 50);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â”€â”€ BOOT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
buildRadar();
updateLabels();
updateLegend();
updateScores();
updateSummary();
</script>
</body>
</html>
